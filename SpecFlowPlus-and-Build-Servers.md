You can set up SpecFlow+ Runner to execute your tests whenever a build is created on your build server. The following covers the settings necessary to use SpecFlow+ with either TFS 2015 or TeamCity. For more information on the build settings in either TFS or TeamCity, please refer to the respective documentation.

#TFS
By default, TFS looks for a profile named TFS.srprofile to execute your tests; if none is found, TFS uses default.srprofile instead. If you have changed the name of your profile, you need to enter the name of your profile in your [[run settings|Configuring-SpecFlowPlus-Runner-Visual-Studio-Test-Explorer-Integration#specflow-runner-settings]] (`<Profile>` element) and enter the path to your `.runsettings` file in the **Run Settings File** field.

##TFS 2015

*Note: General information on running tests with your builds in TFS can be found [[here|https://msdn.microsoft.com/library/vs/alm/test/continuous-testing/test-build]].*

To configure your build process in TFS 2015 to execute tests using SpecFlow+ Runner:

1. Open TFS and switch to your build definition.
1. Click on **Add build step** to add a new step to the build definition. Click on **Test** in the list of categories and click on **Add** next to "Visual Studio Test".
1. Configure the build step as follows:  
  * Enter the path to your **Test Assembly**
  * If you are using both MSTest and SpecFlow+ Runner, enter the path to NuGet package folder in the **Path to Custom Test Adapters** field. If you do not enter the path here, only your MSTest tests will be executed as TFS cannot find the SpecFlow+Runner test adapter.
  * Enter the name of your .srprofile file in the **Run Settings File** field if the name is not `TFS.srprofile` or `default.srprofile` (see above).
1. Save your changes.

Once the test run is complete, links to the report file and logs generated by SpecFlow+ Runner are available from the test run as attachments.

## TFS and XAML
To configure your build process in TFS with XAML:

1. Define your build definition as described [[here|https://msdn.microsoft.com/en-us/library/ms181716%28v=vs.120%29.aspx]]
1. In order for the tests to execute, the binaries (DLLs in the various SpecFlow packages) need to be available to the build agent. Either:
  * Enable NuGet restore, in which cases the files are downloaded automatically
  * Check in the DLLs in the corresponding SpecFlow, SpecRun and SpecFlow+ packages. These DLLs are located in the corresponding sub-folders of your solution's packages directory.
1. Enter the name of your .srprofile file in the **Run Settings File** field if the name is not `TFS.srprofile` or `default.srprofile` (see above).

###Known Issues

* The build agents cache the test adapters, which means that the last test adapter to be used is used for each build. You can thus only use a single SpecFlow+ Runner version with the same build agent, as the cached version is always used. If you want to use a different version of SpecFlow+ Runner for different builds, you need to define separate build agents.
* Upgrading SpecFlow to a newer version requires a restart to purge the cache.



#TeamCity

*Note: General information on configuring build steps in TeamCity can be found [[here|https://confluence.jetbrains.com/display/TCD9/Configuring+Build+Steps]].*

To configure your build process in TeamCity to execute tests using SpecFlow+ Runner:

1. Open your project's build steps.
2. Click on **Add build step**.
3. Choose "Command Line" from the dialogue.
4. Configure the build step as follows:  
  * **Run:** Executable with parameters
  * **Command executable:** Enter the path to SpecRun.exe here
  * **Command parameters:** Enter the command line parameters for SpecRun.exe here. Use the `BuildServerRun` option and include `/buildserver:teamcity`.  
  Information on executing command lines in TeamCity is available [[here|https://confluence.jetbrains.com/display/TCD9/Command+Line]]. More details on the SpecFlow+ Runner's command line options can be found [[here|https://github.com/techtalk/SpecFlowPlus-Resources/wiki/SpecFlowPlus-Runner-Command-Line]].
5. Click on **Save**.

#Jenkins
*Note: General information on installing Jenkins can be found [[here|https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins]].*

The following steps assume that you are using the [[Git plugin|https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin]] to handle your source files. You will also need to install the [[MS Build plugin|https://wiki.jenkins-ci.org/display/JENKINS/MSBuild+Plugin]]. You probably also want to install the [[HTML Publisher plugin|https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin]] to handle reports.

To configure your build process in Jenkins to execute tests using SpecFlow+ Runner:

1. Start the Jenkins web interface.
1. Click on **New Item** to add a new project if you have not already set up a project:  
  1. Enter a name for your project.
  1. Choose "Freestyle project" from the list.
1. On the Jenkins main screen, select **Manage Jenkins** and then **Global Tool Configuration**.
  1. Add a configuration for MSBuild. Give it a meaningful **Name** (e.g. “MSBuild”) and enter the **Path to **MSBuild**.
  1. Add a configuration for VSTest as well. 
1. Select **Configure** From the project's main page.
1. Enable **Git** under **Source Code Management**.
1. Enter your **Repository URL**, e.g. “https://github.com/Me/MyProject.git”. You can also enter your login credentials.
1. Specify which branch to build under **Branches to build**, e.g. “*/master”.
1. Enable **Delete workspace before build starts** under **Build Environment**, otherwise your test results may be incorrect due to the existing TRX files.
1. Click on the **Advanced** button.
1. Click on **Add** next to **Patterns for files to be deleted**:
  Exclude the following:  
  .git/**, TestResults, TestResult/*.html
1. Click on **Add build step** under **Build** and select **Execute Windows batch command**.
1. Add the following **Command**:  
  “C:\PATH\nuget.exe” restore “C:\PATH\MySpecs.sln”  
  Replace “PATH” with the full path to nuget.exe and your solution. This ensures that your NuGet packages are restored each build.
1. Select the MSBuild configuration you defined in the **MSBuild Version** field under **Build a Visual Studio project or solution using MSBuild**.
1. Enter the path to your solution in the **MSBuild Build File** field.
1. Configure your unit tests to run with VSTest.console:  
  * Select the configuration you defined earlier in the **VStest Version** field.
  * **Test Files: Enter the path to the assemblies to be tested here.
  * **Specify a logger for test results**: Select trx.
  * **Command Line Arguments**: Enter `/TestAdapterPath:”C:\PATH\packages”` (replace “C:\PATH\” with the path to your solution’s directory).

** SpecFlow+ Execution Reports (optional)
The SpecFlow+ execution reports are stored in the TestResults directory of your project. To be able to easily access these reports from the project overview in Jenkins:
1. Under **Post-build Actions**, click on **Add post-build action** and select “Publish HTML reports”.
1. Enter the path to your project’s TestResults directory under **HTML dir to archive**.
1. Set the **Index Pages** to “ProjectName_ProfileName*.html” (replace “ProjectName and ProfileName with the name of your project and profile respectively) to reflect the SpecFlow+ report naming convention.

The results of your tests are also visualized by the Jenkins interface, e. g. in the build history and graphs. This information is taken from the TRX file generated by MSTest, which needs to be published as well:
1. Under **Post-build Actions**, click on **Add post-build action** and select “Publish MSTest test result report”. 
1. Enter “**/TestResults/*.trx” in the **Test report TRX file* field under **Publish MSTest test result report**.
